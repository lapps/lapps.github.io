<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="oanc.github.io : GitHub repository for the American National Corpus.">

    <link rel="stylesheet" type="text/css" media="screen" href="/css/slate.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/css/lappsgrid.css"/>
     
	<script type="text/javascript"
		src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>
		<script type="text/javascript">
		MathJax.Hub.Config({
			jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
                inlineMath: [ ['%','%'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                processEscapes: false
            },
        });
    </script>	

    <title>Creating Docker Images</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <!-- <a id="forkme_banner" href="https://github.com/lapps">View on GitHub</a> -->
		  <a id="forkme_banner" href="https://github.com/lapps/lapps.github.io/edit/master/technical/docker.md">Edit this page on GitHub</a>.
		  
          <h1 id="project_title">The LAPPS Grid Wiki</h1>
          <h2 id="project_tagline">A framework for interoperable NLP web services.</h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">


	<h1 id="creating-docker-images">Creating Docker Images</h1>

<p>In Docker lingo it is important to distinguish between an <em>image</em> and a <em>container</em>.
A Docker <em>image</em> is what we make when we get when we run the <code class="highlighter-rouge">docker build</code> command. A 
Docker <em>container</em> is a running instance of an <em>image</em>, that is, what we get when we
run the <code class="highlighter-rouge">docker run</code> command. It is possible to have many running <em>containers</em> started from a single <em>image</em>.</p>

<h2 id="other-documentation">Other Documentation</h2>

<ul>
  <li><a href="https://docs.docker.com/engine/reference/builder/">Docker reference</a></li>
  <li><a href="https://www.digitalocean.com/community/tutorials/docker-explained-using-dockerfiles-to-automate-building-of-images">Docker explained</a></li>
  <li><a href="https://rominirani.com/docker-tutorial-series-writing-a-dockerfile-ce5746617cd#.i175iiq0a">Docker tutorial</a></li>
</ul>

<h2 id="common-directives">Common Directives</h2>

<h4 id="from">FROM</h4>

<p>The <em>FROM</em> directive specifies the base image that will be used for the current image. 
In the LAPPS Grid all images will either be based on one of the <code class="highlighter-rouge">lappsgrid/*</code> images or one 
of the Galaxy images (typically in the <code class="highlighter-rouge">bgruening/*</code> namespace).</p>

<p>The following Lappsgrid images are available:</p>

<ul>
  <li><em>lappsgrid/ubuntu</em> - Ubuntu 14.04 with:
    <ol>
      <li>JDK 1.7</li>
      <li>PostgreSQL 9.3</li>
      <li>emacs, nano, curl, wget, zip, and unzip</li>
    </ol>
  </li>
  <li><em>lappsgrid/tomcat</em> - Extends the <em>lappsgrid/ubuntu</em> image and adds Tomcat 7.</li>
</ul>

<h4 id="copy">COPY</h4>

<p>The <em>COPY</em> directive takes two parameters, a source and a destination, and as the name
suggests, copies the source file to the destination in the image being built.</p>

<p><strong>Example</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>	COPY ./file.txt /usr/local/share/file.txt
</code></pre>
</div>
<p>The above copies file.txt to the /usr/local/share directory in the image being created.</p>

<p><strong>Note</strong></p>

<p>Docker will only copy files from the current directory. You cannot specify an arbitrary 
path as the <em>source</em>.</p>

<h4 id="add">ADD</h4>

<p>The <em>ADD</em> directive is the same as the <em>COPY</em> directive except it does some extra magic.
In particular, the <em>ADD</em> directive will decompress any files when it copies them to the target.</p>

<p>The <em>ADD</em> directiveâ€™s <em>source</em> parameter can also be a URL, in which case Docker will download
the file pointed to by the URL and copy it to the target image.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	ADD http://example.com/file.tgz /usr/share
</code></pre>
</div>

<h4 id="run">RUN</h4>

<p>The <em>RUN</em> directive can be used to execute arbitrary commands when building the image,</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	RUN chmod ug+x /usr/local/share/file.txt
</code></pre>
</div>

<p>Long commands can be be split into several lines with the line continuation character \ and
multiple commands can be run in sequence by joining them with the AND (&amp;&amp;) operator.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	RUN apt-get update <span class="o">&amp;&amp;</span> apt-get upgrade -y <span class="o">&amp;&amp;</span> <span class="se">\</span>
	    apt-get install package1 package2 pacakge3 <span class="o">&amp;&amp;</span> <span class="se">\</span>
		chmod u+x /usr/bin/startup.sh	    		
</code></pre>
</div>

<h4 id="user">USER</h4>

<p>The <em>USER</em> directive specifies the user account subsequent command will be <em>RUN</em> as.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	USER joe
	RUN <span class="nb">echo</span> <span class="s1">'some data'</span> &gt; /home/joe/file.txt <span class="o">&amp;&amp;</span> <span class="se">\</span>
	    chmod a+r /home/joe/file.txt
	    
	USER root
	RUN apt-get install -y package1 package2 package3
</code></pre>
</div>

<h4 id="cmd">CMD</h4>

<p>The <strong>CMD</strong> directive specifies the command that will be run when the container is launched.
When this command terminates the Docker container will exit.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	CMD /usr/bin/startup.sh
</code></pre>
</div>

	
      </section>
    </div>
	<div>
	</div>
    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Copyright &copy; 2017 The Language Application Grid</p>
      </footer>
    </div>

    

  </body>
</html>


