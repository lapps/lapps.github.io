<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="oanc.github.io : GitHub repository for the American National Corpus.">

    <link rel="stylesheet" type="text/css" media="screen" href="/css/slate.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/css/lappsgrid.css"/>
     
	<script type="text/javascript"
		src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>
		<script type="text/javascript">
		MathJax.Hub.Config({
			jax: ["input/TeX", "output/HTML-CSS"],
            tex2jax: {
                inlineMath: [ ['%','%'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                processEscapes: false
            },
        });
    </script>	

    <title>Jupyter Notebook</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <!-- <a id="forkme_banner" href="https://github.com/lapps">View on GitHub</a> -->
		  <a id="forkme_banner" href="https://github.com/lapps/lapps.github.io/edit/master/technical/jupyter.md">Edit this page on GitHub</a>.
		  
          <h1 id="project_title">The LAPPS Grid Wiki</h1>
          <h2 id="project_tagline">A framework for interoperable NLP web services.</h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">


	<h1 id="jupyter-notebook">Jupyter Notebook</h1>

<p>The Lappsgrid Services DSL (LSD) is a <a href="http://groovy-lang.org/">Groovy</a> Domain Specific 
Language that can be used to interact with services on the LAPPS Grid. The Language 
Application Grid has also developed a LSD kernel for use in <a href="http://jupyter.org/">Jupyter Notebooks</a>.</p>

<h2 id="installation">Installation</h2>

<p>It is assumed that users already have <a href="http://jupyter.readthedocs.io/en/latest/install.html">Jupyter installed</a>.
If you don’t have Jupyter, but do have Python the following should work:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$&gt; </span>pip install jupyter
</code></pre>
</div>

<h3 id="install-the-kernel">Install the kernel</h3>

<h4 id="from-source">From Source</h4>

<p>Building the Jupyter LSD Kernel project requires Maven 3.x or higher.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$&gt; </span>git clone https://github.com/lappsgrid-incubator/jupyter-lsd-kernel.git 
<span class="gp">$&gt; </span><span class="nb">cd </span>jupyter-lsd-kernel
<span class="gp">$&gt; </span>mvn package
<span class="gp">$&gt; </span>./install.sh &lt;kernel directory&gt;
</code></pre>
</div>

<p>Where <em>&lt;kernel directory&gt;</em> is a directory where the kernel jar file will be copied and can be any directory on your system.</p>

<h4 id="from-pre-compiled-binaries">From Pre-compiled Binaries</h4>

<p>Download and expand the <a href="http://www.lappsgrid.org/downloads/jupyter-lsd-kernel-latest.tgz">LSD Kernel archive</a> and then run the <em>install.sh</em> script.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$&gt; </span>wget http://www.lappsgrid.org/downloads/jupyter-lsd-kernel-latest.tgz
<span class="gp">$&gt; </span>tar xzf jupyter-lsd-kernel-latest.tgz
<span class="gp">$&gt; </span><span class="nb">cd </span>jupyter-lsd-kernel-x.y.z
<span class="gp">$&gt; </span>./install.sh &lt;kernel directory&gt;
</code></pre>
</div>

<p>Where <em>&lt;kernel directory&gt;</em> is a directory where the kernel jar file will be copied and can be any directory on your system. Replace <em>x.y.z</em> with the current version number.</p>

<h4 id="notes">Notes</h4>

<p>By default the <em>install.sh</em> script will install the Jupyter kernel to the system kernel directory. This is typically <em>/usr/local/share/juptyer</em> on Linux/MacOS systems and <em>%PROGRAMDATA%\jupyter\kernels</em> on Windows systems.  To install the Jupyter kernel to the User’s directory you must either:</p>

<ul>
  <li>Edit the <em>install.script</em> and add the <em>–user</em> option to the <code class="highlighter-rouge">kernelspec</code> command, or</li>
  <li>Edit the kernel.json file to set the <em>argv</em> paramater to the location of the Jupyter Groovy kernel and then run the <code class="highlighter-rouge">jupyter kernelspec install</code> command manually.</li>
</ul>

<p>You can view the default directories that Jupyter uses by running the command <code class="highlighter-rouge">jupyter --paths</code>.</p>

<h3 id="starting-jupyter">Starting Jupyter</h3>

<p>You should now be able to start Jupyter with <code class="highlighter-rouge">jupyter notebook</code> or <code class="highlighter-rouge">jupyter console --kernel lsd</code>.</p>

<p>Jupyter will read/write files (notebooks) in the current directory.</p>

<h3 id="docker">Docker</h3>

<p>A Docker image containing the LSD kernel is available from the <a href="https://hub.docker.com/r/lappsgrid/jupyter-lsd-kernel/">Docker Hub</a>.  The container expects two environment variables to be defined that are used to connect to a Galaxy server:</p>

<ol>
  <li><strong>GALAXY_HOST</strong> The URL to a Galaxy server.</li>
  <li><strong>GALAXY_KEY</strong> The API key for the user on the Galaxy server.</li>
</ol>

<p>Inside the container Jupyter uses the directory <em>/home/jovyan</em> to save and load notebooks.  To persists notebooks created inside the container mount a local directory as <em>/home/jovyan</em>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$&gt; </span><span class="nv">HOST</span><span class="o">=</span>http://galaxy.lappsgrid.org
<span class="gp">$&gt; </span><span class="nv">KEY</span><span class="o">=</span>1234567890DEADBEEF
<span class="gp">$&gt; </span><span class="nv">ENV</span><span class="o">=</span><span class="s2">"-e GALAXY_HOST=</span><span class="nv">$HOST</span><span class="s2"> -e GALAXY_KEY=</span><span class="nv">$KEY</span><span class="s2">"</span>
<span class="gp">$&gt; </span><span class="nv">VOLUME</span><span class="o">=</span><span class="s2">"-v </span><span class="nv">$HOME</span><span class="s2">/notebooks:/home/jovyan"</span>
<span class="gp">$&gt; </span><span class="nv">PORTS</span><span class="o">=</span><span class="s2">"-p 8888:8888"</span>
<span class="gp">$&gt; </span>docker run -d <span class="nv">$PORTS</span> <span class="nv">$ENV</span> <span class="nv">$VOLUME</span> lappsgrid/jupyter-lsd-kernel 
</code></pre>
</div>

<p>Or, if you don’t mind really long command lines the above can be achieved in one line:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$&gt; </span>docker run -d -p 8888:8888 -e <span class="nv">GALAXY_HOST</span><span class="o">=</span>http://galaxy.lappsgrid.org -e <span class="nv">GALAXY_KEY</span><span class="o">=</span>1234567890DEADBEEF -v <span class="nv">$HOME</span>/kernels:/home/jovyan lappsgrid/jupyter-lsd-kernel
</code></pre>
</div>

<h2 id="interacting-with-galaxy">Interacting with Galaxy</h2>

<h3 id="connecting-to-galaxy">Connecting to Galaxy</h3>

<p>The LSD kernel needs two pieces of information to be able to interact with Galaxy:</p>

<ol>
  <li>The URL of the Galaxy server.</li>
  <li>Your Galaxy API key.  If you do not have a Galaxy API key you will need to log in to the Galaxy instance and generate one (User -&gt; Preferences -&gt; Manager your API keys.)</li>
</ol>

<p>You will need to set the environment variables <strong>GALAXY_HOST</strong> and <strong>GALAXY_KEY</strong> before launching Jupyter:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="gp">$&gt; </span><span class="nb">export </span><span class="nv">GALAXY_HOST</span><span class="o">=</span>http://galaxy.example.com:8000
<span class="gp">$&gt; </span><span class="nb">export </span><span class="nv">GALAXY_KEY</span><span class="o">=</span>1234567890DEADBEEF
<span class="gp">$&gt; </span>jupyter notebook
</code></pre>
</div>

<h3 id="galaxy-notebook-functions">Galaxy Notebook Functions</h3>

<p>The following functions are built in to the Jupyter LSD kernel to simplify working with a Galaxy instance.</p>

<p><strong>void selectHistory(String history_name)</strong><br />
Select the Galaxy history to work with.  It is a good practice to always name histories in Galaxy so they may be easily selected in Jupyter.  Since the Galaxy API has no concept of the <em>current history</em> it is impossible to select a history if they are all named <em>“Unnamed history”</em>.</p>

<p><strong>File get(int history_id)</strong><br />
Returns a <em>java.io.File</em> object with the contents of the dataset with the given history id. The history id is simply the integer to the left of the dataset name in the history panel.</p>

<p><strong>void put(Stirng path)</strong><br />
<strong>void put(File file)</strong><br />
Uploads the file to the currently selected Galaxy history.  You may need to refresh the history in Galaxy to see the newly uploaded file.  The dataset name will be the name of the uploaded file.</p>

<p><strong>Object parse(String json)</strong><br />
<strong>Object parse(String json, Class theClass)</strong><br />
Parses a JSON string into an instance of <strong>theClass</strong>.  Calling <code class="highlighter-rouge">parse(json)</code> is the same as calling <code class="highlighter-rouge">parse(json, org.lappsgrid.serialization.Data)</code>.</p>

<p><strong>String toJson(Object object)</strong><br />
Returns the compact JSON string representation of the <code class="highlighter-rouge">object</code>.</p>

<p><strong>String toPrettyJSon(Object object)</strong><br />
Returns a pretty-printed JSON string representation of the <code class="highlighter-rouge">object</code>.</p>

<p><strong>String readline(String prompt)</strong><br />
Prompts the user to enter a line of input and returns that string.  The Jupyter user interface will 
determine the best way to display the prompt to the user and read the user input.</p>

<p><strong>void version()</strong><br />
Displays the current Groovy and LSD kernel versions.</p>

<p><strong>GalaxyInstance galaxy()</strong><br />
<strong>HistoriesClient histories()</strong><br />
<strong>ToolsClient tools()</strong><br />
<strong>History history()</strong><br />
Returns handles to the various Galaxy clients. See the Blend4J API documentation (link needed) for more information on these clients.</p>

<h2 id="examples">Examples</h2>
<p>The LSD kernel provides two methods for interacting with Galaxy: <code class="highlighter-rouge">get(int)</code> and <code class="highlighter-rouge">put(File)</code>. The <code class="highlighter-rouge">get</code>
method downloads a data set item from the current history into a <code class="highlighter-rouge">java.io.File</code> object. The
int parameter is the history id number of the item to be downloaded.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="mi">42</span><span class="o">)</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">put</code> command uploads a <code class="highlighter-rouge">java.io.File</code> to the current Galaxy history.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">'/tmp/HelloWorld.txt'</span><span class="o">)</span>
<span class="n">f</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="s1">'Hello world'</span>
<span class="n">put</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>
</code></pre>
</div>
<p>The filename will be used as the dataset name in the history panel so it is recommended to use a meaningful filename.</p>

<h3 id="handling-json">Handling JSON</h3>

<p>Use the <code class="highlighter-rouge">parse(String, Class)</code> method to parse a JSON String into an object.  <strong>Note:</strong> in
Groovy you do not need to include the <em>.class</em> suffix when specifying a Java/Groovy class.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="mi">42</span><span class="o">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">parse</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">text</span><span class="o">,</span> <span class="n">DataContainer</span><span class="o">)</span>
</code></pre>
</div>

<p>The above reads the JSON from the file and parses it into a <a href="http://wiki.lappsgrid.org/org.lappsgrid.serialization/groovydoc/org/lappsgrid/serialization/DataContainer.html">DataContainer</a> object.</p>

<p>Use the <code class="highlighter-rouge">toJSon</code> or <code class="highlighter-rouge">toPrettyJson</code> methods to convert an object into a JSON string.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="o">[</span> <span class="nl">name:</span><span class="s1">'Bob'</span><span class="o">,</span> <span class="nl">species:</span><span class="s1">'Dog'</span> <span class="o">]</span> 
<span class="n">f</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">'/tmp/test.json'</span><span class="o">)</span>
<span class="n">f</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">toJson</span><span class="o">(</span><span class="n">data</span><span class="o">)</span>
</code></pre>
</div>

<h3 id="programming-notes">Programming Notes</h3>

<ol>
  <li>The last statement executed in a cell will be the <em>return value</em> for that cell.</li>
</ol>

<h3 id="scoping">Scoping</h3>

<p>The LSD kernel supports both global and local variables. To define a local variable
include the type (or use the <code class="highlighter-rouge">def</code> keyword) when defining the variable.  If the first use
of a variable does not include a type it is assumed to be a global variable.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">String</span> <span class="n">s1</span> <span class="o">=</span> <span class="s1">'This is a local variable.'</span>
<span class="n">s2</span> <span class="o">=</span> <span class="s1">'s2 will be global variable if it has not been declared already.'</span>
</code></pre>
</div>

<p>Global variables can be used in any cell while local variables are only visible in the cell
that defines them.</p>

<p>A cell can also define functions that can be used later in that cell.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">Container</span> <span class="nf">getContainer</span><span class="o">(</span><span class="kt">int</span> <span class="n">historyId</span><span class="o">)</span> <span class="o">{</span>
	<span class="n">File</span> <span class="n">f</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="n">historyId</span><span class="o">)</span>
	<span class="n">DataContainer</span> <span class="n">dc</span> <span class="o">=</span> <span class="n">parse</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">text</span><span class="o">,</span> <span class="n">DataContainer</span><span class="o">)</span>
	<span class="k">return</span> <span class="n">dc</span><span class="o">.</span><span class="na">payload</span>
<span class="o">}</span>

<span class="n">container</span> <span class="o">=</span> <span class="n">getContainer</span><span class="o">(</span><span class="mi">42</span><span class="o">)</span>
<span class="n">container</span><span class="o">.</span><span class="na">text</span>
</code></pre>
</div>

<p>Use a Groovy closure to define a function that can be used in other cells</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c1">// In one cell.</span>
<span class="n">getContainer</span> <span class="o">=</span>  <span class="o">{</span> <span class="n">historyId</span> <span class="o">-&gt;</span>
	<span class="n">File</span> <span class="n">f</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="n">historyId</span><span class="o">)</span>
	<span class="n">DataContainer</span> <span class="n">dc</span> <span class="o">=</span> <span class="n">parse</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">text</span><span class="o">,</span> <span class="n">DataContainer</span><span class="o">)</span>
	<span class="k">return</span> <span class="n">dc</span><span class="o">.</span><span class="na">payload</span>
<span class="o">}</span>

<span class="c1">// In another cell.</span>
<span class="n">container</span> <span class="o">=</span> <span class="n">getContainer</span><span class="o">(</span><span class="mi">42</span><span class="o">)</span>
<span class="n">container</span><span class="o">.</span><span class="na">text</span>
</code></pre>
</div>

<h1 id="example--create-a-list-of-all-locations-in-a-document">Example : Create a list of all locations in a document.</h1>

<p>Each of the following steps should be run in their own cell in a Jupyter Notebook. A Notebook
with the following exercise can be downloaded <a href="WikiExample.ipynb">here</a>.</p>

<h4 id="step-1--load-a-document-into-a-galaxy-history">Step 1 : Load a document into a Galaxy history</h4>

<ol>
  <li>Log in to Galaxy and create a new History.</li>
  <li>Select the <code class="highlighter-rouge">Get Document</code> tool from the MASC section.  Use the key <em>MASC2-0040</em> and select <em>Gold Annotations</em> as the <code class="highlighter-rouge">type</code>.</li>
</ol>

<h4 id="step-2--load-the-galaxy-document-into-jupyter">Step 2 : Load the Galaxy document into Jupyter</h4>

<ol>
  <li>Open a Jupyter Notebook and start a LSD kernel.</li>
  <li>In the first cell run the following text (ctl+Enter runs the current cell).</li>
</ol>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">f</span> <span class="o">=</span> <span class="n">get</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>
</code></pre>
</div>

<p>After a moment you should see something like:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="s">/var/</span><span class="n">folders</span><span class="s">/3g/</span><span class="n">l8qm57w53zl2ndjlblpgd26h0000gn</span><span class="s">/T/</span><span class="n">groovy</span><span class="o">-</span><span class="n">kernel</span><span class="o">-</span><span class="mi">4125104986707886180</span><span class="o">.</span><span class="na">dat</span>
</code></pre>
</div>

<h4 id="step-3--parse-the-document-text">Step 3 : Parse the document text</h4>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="n">parse</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="na">text</span><span class="o">,</span> <span class="n">DataContainer</span><span class="o">)</span>
<span class="n">container</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">payload</span>
</code></pre>
</div>

<h4 id="step-4--find-the-view-with-named-entities">Step 4 : Find the view with named entities</h4>

<p>In the MASC Gold Annotation data each annotation type is loaded into its own <a href="http://wiki.lappsgrid.org/org.lappsgrid.serialization/groovydoc/org/lappsgrid/serialization/lif/View.html">View</a>
object. Before we can construct a list of locations we first need to find the view that
contains named entities.  That is, we need to check the metadata for each view to see which
one contains <a href="http://wiki.lappsgrid.org/org.lappsgrid.discriminator/apidocs/org/lappsgrid/discriminator/Discriminators.Uri.html">Uri.NE</a> annotations.</p>

<p>Fortunately, the Groovy <code class="highlighter-rouge">find</code> method makes this easy.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">view</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="na">views</span><span class="o">.</span><span class="na">find</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">metadata</span><span class="o">.</span><span class="na">contains</span><span class="o">[</span><span class="n">Uri</span><span class="o">.</span><span class="na">NE</span><span class="o">]</span> <span class="o">}</span>
</code></pre>
</div>

<h4 id="step-5--filter-just-the-location">Step 5 : Filter just the location</h4>

<p>Now that we have the view that contains the named entities we need to find the annotations
for locations.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">locations</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="na">annotations</span><span class="o">.</span><span class="na">findAll</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">atType</span> <span class="o">==</span> <span class="n">Uri</span><span class="o">.</span><span class="na">LOCATION</span> <span class="o">}</span>
</code></pre>
</div>

<h4 id="step-5--create-a-closure-to-get-the-text-covered-by-an-annotation">Step 5 : Create a closure to get the text covered by an annotation.</h4>

<p>The MASC NE annotations do not include the span of text being annotated so we need to 
retrieve the text from the document text, which is stored in <code class="highlighter-rouge">container.text</code>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">getText</span> <span class="o">=</span> <span class="o">{</span> <span class="n">Annotation</span> <span class="n">a</span> <span class="o">-&gt;</span>
	<span class="k">return</span> <span class="n">container</span><span class="o">.</span><span class="na">text</span>
		<span class="o">.</span><span class="na">substring</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span><span class="n">a</span><span class="o">.</span><span class="na">start</span><span class="o">,</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">a</span><span class="o">.</span><span class="na">end</span><span class="o">)</span>
		<span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">'\n'</span><span class="o">,</span> <span class="s1">' '</span><span class="o">)</span>
		<span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">'  +'</span><span class="o">,</span> <span class="s1">' '</span><span class="o">)</span>
<span class="o">}</span>
</code></pre>
</div>

<h5 id="step-7--get-the-text-for-each-location">Step 7 : Get the text for each location</h5>

<p>We will save the locations to a Set object so we get a list
of unique locations.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">unique</span> <span class="o">=</span> <span class="o">[]</span> <span class="k">as</span> <span class="n">HashSet</span>
<span class="n">locations</span><span class="o">.</span><span class="na">each</span> <span class="o">{</span> 
	<span class="n">unique</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">getText</span><span class="o">(</span><span class="n">it</span><span class="o">))</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="step-8--save-the-locations-and-upload-to-galaxy">Step 8 : Save the locations and upload to Galaxy.</h4>

<p>We first need to write the unique location names to a temporary file and then <code class="highlighter-rouge">put</code> that
file to Galaxy.  The name of the file will be the name of the history item in Galaxy so it
is a good idea to use a human-friendly name.  We also sort the set before writing to the 
file to make the output easier to read.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">File</span> <span class="n">t</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s1">'/tmp/Locations.txt'</span><span class="o">)</span>
<span class="n">t</span><span class="o">.</span><span class="na">withWriter</span> <span class="o">{</span> <span class="n">writer</span> <span class="o">-&gt;</span>
	<span class="n">unique</span><span class="o">.</span><span class="na">sort</span><span class="o">().</span><span class="na">each</span> <span class="o">{</span> <span class="n">writer</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">it</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
<span class="n">put</span><span class="o">(</span><span class="n">t</span><span class="o">)</span>
<span class="n">t</span><span class="o">.</span><span class="na">delete</span><span class="o">()</span>
</code></pre>
</div>

<p><strong>Note</strong> When you return to Galaxy you will need to refresh the history to see the newly
uploaded item.</p>

<p>Enjoy!</p>

<h2 id="mapreducefilter">Map/Reduce/Filter</h2>

<p>Version 1.1.0-SNAPSHOT of the Jupyter LSD kernel adds the methods <em>map</em>, <em>reduce</em>, and <em>filter</em> to the Java Collection classes.
While Groovy has the methods <em>collect</em>, <em>inject</em>, and <em>grep</em> (or <em>find</em>/<em>findAll</em>) many people are more comfortable
with the names map, reduce and filter.  In fact the map, reducer, filter methods simply delegate to
collect, inject and grep.</p>

<p>This is the same example as above only using map, reduce, filter methods:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">data</span> <span class="o">=</span> <span class="n">parse</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">text</span><span class="o">,</span> <span class="n">DataCollection</span><span class="o">)</span>
<span class="n">data</span><span class="o">.</span><span class="na">payload</span><span class="o">.</span><span class="na">views</span>
	<span class="o">.</span><span class="na">find</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">metadata</span><span class="o">.</span><span class="na">contains</span><span class="o">[</span><span class="n">Uri</span><span class="o">.</span><span class="na">NE</span><span class="o">]</span> <span class="o">}</span>
	<span class="o">.</span><span class="na">annotations</span>
	<span class="o">.</span><span class="na">filter</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">atType</span> <span class="o">==</span> <span class="n">Uri</span><span class="o">.</span><span class="na">LOCATION</span> <span class="o">}</span>
	<span class="o">.</span><span class="na">map</span> <span class="o">{</span> <span class="n">data</span><span class="o">.</span><span class="na">payload</span><span class="o">.</span><span class="na">text</span><span class="o">.</span><span class="na">substring</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span><span class="n">it</span><span class="o">.</span><span class="na">start</span><span class="o">,</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span><span class="n">it</span><span class="o">.</span><span class="na">end</span><span class="o">)</span> <span class="o">}</span>
	<span class="o">.</span><span class="na">map</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">'\n'</span><span class="o">,</span> <span class="s1">' '</span><span class="o">)</span> <span class="o">}</span>
	<span class="o">.</span><span class="na">map</span> <span class="o">{</span> <span class="n">it</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s1">'  +'</span><span class="o">,</span> <span class="s1">' '</span><span class="o">)</span> <span class="o">}</span>
	<span class="o">.</span><span class="na">reduce</span><span class="o">([]</span> <span class="k">as</span> <span class="n">HashSet</span><span class="o">)</span> <span class="o">{</span> <span class="n">set</span><span class="o">,</span><span class="n">value</span> <span class="o">-&gt;</span> <span class="n">set</span> <span class="o">&lt;&lt;</span> <span class="n">value</span> <span class="o">}</span>
	<span class="o">.</span><span class="na">sort</span><span class="o">()</span>
	<span class="o">.</span><span class="na">reduce</span><span class="o">(</span><span class="k">new</span> <span class="n">StringWriter</span><span class="o">())</span> <span class="o">{</span> <span class="n">writer</span><span class="o">,</span> <span class="n">value</span> <span class="o">-&gt;</span> <span class="n">writer</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="o">;</span> <span class="n">writer</span> <span class="o">&lt;&lt;</span> <span class="s1">'\n'</span> <span class="o">}</span>
	<span class="o">.</span><span class="na">toString</span><span class="o">()</span>	
	
</code></pre>
</div>

	
      </section>
    </div>
	<div>
	</div>
    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p>Copyright &copy; 2017 The Language Application Grid</p>
      </footer>
    </div>

    

  </body>
</html>


